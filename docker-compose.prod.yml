# Production docker-compose override file
# Usage: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
#
# This file adds production-specific configurations:
# - MongoDB authentication
# - Network isolation
# - Increased resource limits
# - Removes public MongoDB port exposure

services:
  mongo:
    ports: []  # Remove public port exposure in production
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_ROOT_USERNAME:-admin}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_ROOT_PASSWORD}
    command: mongod --auth
    networks:
      - internal
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 2G
        reservations:
          cpus: '1.0'
          memory: 1G

  backend:
    environment:
      DB_URI: "mongodb://${MONGO_ROOT_USERNAME:-admin}:${MONGO_ROOT_PASSWORD}@mongo:27017/${DB_NAME:-resume_screening}?authSource=admin"
      ENVIRONMENT: "production"
    networks:
      - internal
      - external
    deploy:
      resources:
        limits:
          cpus: '4.0'
          memory: 4G
        reservations:
          cpus: '2.0'
          memory: 2G

  frontend:
    build:
      args:
        VITE_API_BASE_URL: ${VITE_API_BASE_URL}
    networks:
      - external
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M

networks:
  internal:
    driver: bridge
    internal: false  # Allow backend to access MongoDB
  external:
    driver: bridge

